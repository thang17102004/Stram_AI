<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI File Processor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background-color: #f9f9f9;
      text-align: center;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .upload-area, .actions, .output, .export-buttons {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }

    .upload-area input[type="file"] {
      margin-top: 10px;
    }

    .actions button, .export-buttons button {
      margin: 10px 5px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      transition: background-color 0.2s ease;
    }

    .actions button:hover, .export-buttons button:hover {
      background-color: #45a049;
    }

    .output {
      min-height: 200px;
      text-align: left;
      white-space: pre-wrap;
      background: #f0f0f0;
    }
  </style>
</head>
<body>
  <div class="container">

    <div class="upload-area">
      <h2>üìÑ T·∫£i file vƒÉn b·∫£n l√™n</h2>
      <input type="file" id="fileInput" required />
    </div>

    <div class="actions">
      <button onclick="handleFunction('fixSpell')">S·ª≠a l·ªói ch√≠nh t·∫£</button>
      <button onclick="handleFunction('summary')">T√≥m t·∫Øt</button>
      <button onclick="handleFunction('convert')">Chuy·ªÉn sang pdf</button>
      <button onclick="handleFunction('analyze')">Ph√¢n t√≠ch tr√≠ch xu·∫•t</button>
      <!-- B·∫°n c√≥ th·ªÉ th√™m n√∫t kh√°c ·ªü ƒë√¢y -->
    </div>

    <div class="output" id="output">
      <p><i>K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y...</i></p>
    </div>

    <div class="export-buttons">
      <button onclick="exportTo('word')">Xu·∫•t ra Word</button>
      <button onclick="exportTo('pdf')">Xu·∫•t ra PDF</button>
    </div>

  </div>

  <script>
    // Ch·ª©c nƒÉng khi th·ª±c hi·ªán tr√™n file
    function handleFunction(action) {
      const file = document.getElementById('fileInput').files[0];
      if (!file) {
        alert('Vui l√≤ng ch·ªçn file!');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);
      formData.append('action', action);

      const output = document.getElementById('output');
      output.innerText = '‚è≥ ƒêang x·ª≠ l√Ω...';

      fetch(`/handleFunction/${action}`, {
      method: 'POST',
      body: formData //T·ª± ƒë·ªông t·∫°o multipart/form-data
      })
      .then(res => {
        if (action === 'convert') {
          return res.blob();
        } else {
          return res.json();
        }
      })
      .then(data => {
      if (action === 'convert') {
        const url = window.URL.createObjectURL(data);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'output.pdf';
        a.click();
        window.URL.revokeObjectURL(url);
        output.innerText = '‚úÖ File PDF ƒë√£ ƒë∆∞·ª£c t·∫£i v·ªÅ!';
      } else {
        output.innerText = data.result || 'Kh√¥ng c√≥ k·∫øt qu·∫£';
      }
    })
      .catch(err => {
        output.innerText = '‚ùå L·ªói x·ª≠ l√Ω: ' + err.message;
        console.error("L·ªói ph√≠a client:", err);
      });
    }

    //Xu·∫•t k·∫øt qu·∫£ docx, pdf
    function exportTo(format) {
    const output = document.getElementById("output");
    const content = output.innerText;

    fetch(`/handleFunction/export${format === "word" ? "Word" : "Pdf"}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ content })
    })
    .then(res => res.blob())
    .then(blob => {
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `ketqua.${format}`;
      link.click();
    })
    .catch(err => {
      console.error("Export l·ªói:", err);
      alert("‚ùå L·ªói export file!");
    });
  }
  </script>
</body>
</html>
